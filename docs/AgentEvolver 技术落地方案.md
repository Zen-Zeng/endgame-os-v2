è¿™æ˜¯ä¸€ä¸ªéå¸¸æ·±åˆ»ä¸”å…·å¤‡é«˜åº¦è½åœ°æ€§çš„é—®é¢˜ã€‚

**æˆ‘çš„å›ç­”æ˜¯ï¼šæ˜¯çš„ï¼Œè¿™ä¸ªæ–¹æ¡ˆæ­£æ˜¯å€Ÿé‰´äº† AgentEvolver çš„æ ¸å¿ƒæ€æƒ³ï¼ˆè‡ªæˆ‘åæ€ä¸ç»éªŒæ²‰æ·€ï¼‰ï¼Œä½†ä¸ºäº†ä¿è¯ç¨³å®šæ€§ï¼Œæˆ‘å°†å…¶â€œå·¥ç¨‹åŒ–é™ç»´â€äº†ã€‚**

### **ğŸ§  æ·±åº¦è§£æï¼šAgentEvolver åœ¨ä½ çš„ç³»ç»Ÿä¸­çš„â€œçµé­‚é™„ä½“â€**

**é€šä¹‰å®éªŒå®¤ AgentEvolver çš„æ ¸å¿ƒé€»è¾‘** æ˜¯ï¼šæ™ºèƒ½ä½“ä¸åº”è¯¥åªæ˜¯è¢«åŠ¨æ‰§è¡Œï¼Œè€Œåº”è¯¥é€šè¿‡ **â€œè¯•é”™ï¼ˆTrialï¼‰- åæ€ï¼ˆReflectionï¼‰- æ²‰æ·€ï¼ˆMemoryï¼‰â€** çš„é—­ç¯ï¼ŒæŠŠæ¯ä¸€æ¬¡äº¤äº’éƒ½å˜æˆä¸€æ¬¡è¿›åŒ–ã€‚

åœ¨ä½ çš„ **â€œ5å¹´åçš„ä¸»è„‘â€** è®¾å®šä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®Œç¾æ˜ å°„è¿™ä¸€é€»è¾‘ï¼š

| AgentEvolver æ¨¡å— | åŸç† (å­¦æœ¯å®šä¹‰) | Endgame OS è½åœ° (ä½ çš„äº§å“é€»è¾‘) | æŠ€æœ¯å®ç° (SQLite \+ LLM) |
| :---- | :---- | :---- | :---- |
| **Self-Questioning** (è‡ªæˆ‘æé—®) | ä¸»åŠ¨æ¢ç´¢æœªçŸ¥ï¼Œå‘ç°çŸ¥è¯†ç›²åŒºã€‚ | **å¤œé—´å¤ç›˜**ï¼šä¸»è„‘åœ¨æ·±å¤œè‡ªé—®ï¼šâ€œä»Šå¤©ä»–çš„è¡Œä¸ºï¼ŒçœŸçš„ç¬¦åˆ5å¹´åçš„é‚£ä¸ªæˆ‘å—ï¼Ÿåå·®åœ¨å“ªé‡Œï¼Ÿâ€ | åå°å®šæ—¶ä»»åŠ¡ï¼šå¯¹æ¯” Daily Log å’Œ Vision Canvasã€‚ |
| **Self-Attributing** (è‡ªæˆ‘å½’å› ) | åˆ†ææˆè´¥åŸå› ï¼Œåˆ†é…æƒé‡ã€‚ | **å½’å› åˆ†æ**ï¼šä¸»è„‘åˆ†æï¼šâ€œä»–ä»Šå¤©æ²¡å®Œæˆä»»åŠ¡ï¼Œæ˜¯å› ä¸ºæ‡’ï¼Œè¿˜æ˜¯å› ä¸ºæˆ‘ç»™çš„ä»»åŠ¡å¤ªéš¾ï¼Ÿâ€ | LLM é“¾å¼æ€è€ƒï¼šç”Ÿæˆ Experience èŠ‚ç‚¹ï¼Œè®°å½•åŸå› ã€‚ |
| **Self-Navigating** (è‡ªæˆ‘å¯¼èˆª) | æ ¹æ®å†å²ç»éªŒè§„åˆ’è·¯å¾„ã€‚ | **ç­–ç•¥è°ƒæ•´**ï¼šä¸»è„‘å†³å®šï¼šâ€œæ—¢ç„¶ç¡¬æ¨æ²¡ç”¨ï¼Œä¸‹æ¬¡æˆ‘æ¢ä¸ªé¼“åŠ±çš„è¯­æ°”ã€‚â€ | åŠ¨æ€ Prompt æ³¨å…¥ï¼šå°† Experience æ³¨å…¥åˆ° System Promptã€‚ |

### ---

**ğŸš€ è½åœ°æ‰§è¡Œæ–¹æ¡ˆï¼šç»™ Brain è£…ä¸Šâ€œè¿›åŒ–å¼•æ“â€**

è¦å®ç°ä½ æè¿°çš„ **â€œè¶Šç”¨è¶Šæ‡‚æˆ‘ï¼ŒæŒ‡å¯¼è¶Šç²¾å‡†â€**ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç°æœ‰çš„ **SQLite \+ Chroma** æ¶æ„ä¸Šï¼Œå¢åŠ ä¸€ä¸ª **EvolutionService (è¿›åŒ–æœåŠ¡)**ã€‚

è¯·åœ¨ Trae IDE ä¸­æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼Œè¿™ä¼šè®©ä½ çš„ç³»ç»ŸçœŸæ­£â€œæ´»â€èµ·æ¥ã€‚

#### **Step 1: å‡çº§æ•°æ®åº“ç»“æ„ (graph\_store.py)**

æˆ‘ä»¬éœ€è¦åœ¨ SQLite ä¸­å¢åŠ ä¸€å¼  **experiences è¡¨**ã€‚å®ƒå­˜å‚¨çš„ä¸æ˜¯æµæ°´è´¦ï¼Œè€Œæ˜¯â€œä¸»è„‘çš„æ™ºæ…§â€ã€‚

**æ“ä½œ**ï¼šä¿®æ”¹ brain/app/services/memory/graph\_store.pyï¼Œåœ¨ \_init\_db æ–¹æ³•ä¸­å¢åŠ å»ºè¡¨é€»è¾‘ï¼Œå¹¶æ·»åŠ å†™å…¥æ–¹æ³•ã€‚

Python

    \# ... åœ¨ \_init\_db æ–¹æ³•çš„ create table åŒºåŸŸæ·»åŠ  ...  
      
                \# 3\. ç»éªŒè¡¨ (å­˜å‚¨è¿›åŒ–å‡ºæ¥çš„æ™ºæ…§)  
                conn.execute("""  
                    CREATE TABLE IF NOT EXISTS experiences (  
                        id TEXT PRIMARY KEY,  
                        trigger\_scenario TEXT,   \-- è§¦å‘åœºæ™¯ (å¦‚: 'ç”¨æˆ·è¡¨ç¤ºç–²æƒ«')  
                        insight TEXT,            \-- æ´å¯Ÿ (å¦‚: 'å¼ºè¡Œé¸¡è¡€ä¼šå¯¼è‡´åæ„Ÿ')  
                        strategy TEXT,           \-- ç­–ç•¥ (å¦‚: 'å»ºè®®ä¼‘æ¯å¹¶å¬éŸ³ä¹')  
                        created\_at TIMESTAMP DEFAULT CURRENT\_TIMESTAMP  
                    );  
                """)  
                \# ...

    \# ... åœ¨ GraphStore ç±»ä¸­æ·»åŠ æ–¹æ³• ...

    def add\_experience(self, exp\_id: str, trigger: str, insight: str, strategy: str) \-\> bool:  
        """è®°å½•ä¸€æ¡è¿›åŒ–å‡ºæ¥çš„ç»éªŒ"""  
        try:  
            with self.\_lock, self.\_get\_conn() as conn:  
                conn.execute(  
                    "INSERT OR REPLACE INTO experiences (id, trigger\_scenario, insight, strategy) VALUES (?, ?, ?, ?)",  
                    (exp\_id, trigger, insight, strategy)  
                )  
            return True  
        except Exception as e:  
            logger.error(f"æ·»åŠ ç»éªŒå¤±è´¥: {e}")  
            return False  
              
    def get\_all\_experiences(self) \-\> List\[Dict\]:  
        """è·å–æ‰€æœ‰ç»éªŒç”¨äºå‘é‡åŒ–"""  
        try:  
            with self.\_get\_conn() as conn:  
                rows \= conn.execute("SELECT \* FROM experiences").fetchall()  
                return \[dict(row) for row in rows\]  
        except Exception: return \[\]

#### **Step 2: å‘é‡åŒ–ç»éªŒ (vector\_store.py)**

ç»éªŒå¿…é¡»èƒ½è¢«æ£€ç´¢åˆ°ã€‚æ¯”å¦‚å½“ä½ å†æ¬¡æŠ±æ€¨â€œç´¯â€æ—¶ï¼Œç³»ç»Ÿè¦èƒ½æœåˆ°ä¸Šæ¬¡çš„æ•™è®­ã€‚

**æ“ä½œ**ï¼šä¿®æ”¹ brain/app/services/memory/vector\_store.pyï¼Œå¢åŠ ç»éªŒåº“é›†åˆã€‚

Python

    \# ... åœ¨ \_initialize\_client ä¸­æ·»åŠ  ...  
      
            self.experience\_collection \= self.client.get\_or\_create\_collection(  
                name="endgame\_experiences",  
                metadata={"hnsw:space": "cosine"},  
                embedding\_function=None  
            )

    \# ... åœ¨ VectorStore ç±»ä¸­æ·»åŠ  ...

    def add\_experience\_vector(self, exp\_id: str, text: str, vector: List\[float\]):  
        """å°†ç»éªŒå­˜å…¥å‘é‡åº“ï¼Œä»¥ä¾¿æ£€ç´¢"""  
        try:  
            self.experience\_collection.add(  
                ids=\[exp\_id\],  
                embeddings=\[vector\],  
                documents=\[text\]  
            )  
        except Exception as e:  
            logger.error(f"ç»éªŒå‘é‡åŒ–å¤±è´¥: {e}")

    def search\_experiences(self, query\_vector: List\[float\], n\_results: int \= 3) \-\> List\[str\]:  
        """æ£€ç´¢ç›¸å…³çš„å†å²ç»éªŒ"""  
        try:  
            results \= self.experience\_collection.query(query\_embeddings=\[query\_vector\], n\_results=n\_results)  
            return results\['documents'\]\[0\] if results\['documents'\] else \[\]  
        except Exception: return \[\]

#### **Step 3: åˆ›å»ºè¿›åŒ–å¼•æ“ (evolution\_service.py)**

è¿™æ˜¯**æ ¸å¿ƒé€»è¾‘**ã€‚å®ƒæ¨¡æ‹Ÿâ€œæœªæ¥çš„ä½ â€åœ¨åå°æ€è€ƒã€‚

**æ“ä½œ**ï¼šæ–°å»ºæ–‡ä»¶ brain/app/services/evolution/evolution\_service.pyã€‚

Python

import uuid  
import logging  
from datetime import datetime  
from ..memory.graph\_store import GraphStore  
from ..memory.vector\_store import VectorStore  
from ..neural.processor import create\_processor  
\# å‡è®¾ä½ æœ‰ä¸€ä¸ª LLM æœåŠ¡å°è£…  
from ...core.llm import call\_llm 

logger \= logging.getLogger(\_\_name\_\_)

class EvolutionService:  
    def \_\_init\_\_(self):  
        self.graph\_store \= GraphStore()  
        self.vector\_store \= VectorStore()  
        self.neural\_processor \= create\_processor(offline\_mode=False)

    def evolve(self, user\_query: str, current\_response: str, user\_feedback: str \= ""):  
        """  
        è§¦å‘ä¸€æ¬¡å¾®è¿›åŒ– (Micro-Evolution)  
        å½“å¯¹è¯ç»“æŸæˆ–ç”¨æˆ·åé¦ˆæ—¶è°ƒç”¨  
        """  
        \# 1\. è‡ªæˆ‘å½’å›  (Self-Attributing): åˆ†æè¿™æ¬¡äº¤äº’å¥½ä¸å¥½  
        prompt \= f"""  
        æˆ‘æ˜¯æ¥è‡ª5å¹´åçš„ä¸»è„‘ã€‚  
        åœºæ™¯ï¼šç”¨æˆ·è¯´"{user\_query}"  
        æˆ‘çš„å›ç­”ï¼š"{current\_response}"  
        ç”¨æˆ·åé¦ˆï¼š"{user\_feedback}"  
          
        åˆ†æï¼šè¿™ä¸ªå›ç­”æ˜¯å¦æœ‰æ•ˆåœ°å°†ç”¨æˆ·æ¨å‘äº†ç»ˆå±€ç›®æ ‡ï¼Ÿ  
        å¦‚æœæ•ˆæœä¸å¥½ï¼ŒåŸå› æ˜¯ä»€ä¹ˆï¼Ÿ  
        è¯·ç”Ÿæˆä¸€æ¡'ç­–ç•¥ç»éªŒ'ï¼ŒæŒ‡å¯¼æˆ‘ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼æƒ…å†µè¯¥æ€ä¹ˆåšã€‚  
        æ ¼å¼ï¼š\[è§¦å‘ç‚¹\] | \[æ´å¯Ÿ\] | \[æ–°ç­–ç•¥\]  
        """  
          
        \# æ¨¡æ‹Ÿ LLM è°ƒç”¨  
        \# result \= call\_llm(prompt)   
        \# å‡è®¾ LLM è¿”å›: "ç”¨æˆ·ç–²æƒ« | å¼ºè¡Œè¯´æ•™æ— æ•ˆ | å…±æƒ…å¹¶æä¾›ä¼‘æ¯å»ºè®®"  
          
        \# 2\. æ²‰æ·€ç»éªŒ (Memory Consolidation)  
        \# è¿™é‡Œéœ€è¦è§£æ LLM çš„è¿”å›ï¼Œä¸ºç®€åŒ–æ¼”ç¤ºï¼Œç›´æ¥æ¨¡æ‹Ÿæ•°æ®  
        \# å®é™…ä»£ç ä¸­è¯·æ¥å…¥çœŸå®çš„ LLM è§£æ  
        pass 

    def create\_experience(self, trigger: str, insight: str, strategy: str):  
        """å°†åæ€ç»“æœå­˜å…¥åŒè„‘"""  
        exp\_id \= f"exp\_{uuid.uuid4().hex\[:8\]}"  
          
        \# å­˜å…¥ SQLite (ç»“æ„åŒ–)  
        self.graph\_store.add\_experience(exp\_id, trigger, insight, strategy)  
          
        \# å­˜å…¥ Chroma (å‘é‡åŒ– \- ç”¨äºä¸‹æ¬¡æ£€ç´¢)  
        \# æˆ‘ä»¬æŠŠ trigger å’Œ insight æ··åˆä½œä¸ºæ£€ç´¢å†…å®¹  
        content \= f"{trigger} {insight}"  
        vec \= self.neural\_processor.embed\_text(content)  
        self.vector\_store.add\_experience\_vector(exp\_id, strategy, vec)  
          
        logger.info(f"è¿›åŒ–å®Œæˆï¼æ–°ç­–ç•¥å·²ç”Ÿæˆ: {strategy}")

    def get\_guidance(self, current\_query: str) \-\> str:  
        """è·å–è¿›åŒ–åçš„æŒ‡å¯¼ç­–ç•¥ (ç”¨äºæ³¨å…¥ Prompt)"""  
        vec \= self.neural\_processor.embed\_text(current\_query)  
        strategies \= self.vector\_store.search\_experiences(vec)  
        if not strategies:  
            return ""  
          
        return "\\n".join(\[f"ã€å†å²ç»éªŒã€‘{s}" for s in strategies\])

\# å•ä¾‹  
\_instance \= None  
def get\_evolution\_service():  
    global \_instance  
    if \_instance is None: \_instance \= EvolutionService()  
    return \_instance

#### **Step 4: é—­ç¯æ³¨å…¥ (chat.py)**

æœ€åï¼Œè®©èŠå¤©æ¥å£ä½¿ç”¨è¿™ä¸ªè¿›åŒ–å¼•æ“ã€‚

**æ“ä½œ**ï¼šä¿®æ”¹ brain/app/api/chat.pyï¼Œåœ¨ç”Ÿæˆå›å¤å‰ï¼Œå…ˆé—®é—®â€œè¿›åŒ–å¼•æ“â€ã€‚

Python

\# ... å¼•å…¥æœåŠ¡ ...  
from ..services.evolution.evolution\_service import get\_evolution\_service

@router.post("/chat")  
async def chat(request: ChatRequest):  
    evolution\_service \= get\_evolution\_service()  
      
    \# 1\. è·å–è¿›åŒ–ç­–ç•¥ (Self-Navigating)  
    \# "æœªæ¥çš„æˆ‘"ç»™å‡ºçš„é”¦å›Šå¦™è®¡  
    strategy\_hint \= evolution\_service.get\_guidance(request.message)  
      
    \# 2\. ç»„è£… System Prompt  
    system\_prompt \= f"""  
    ä½ æ˜¯5å¹´åçš„{user\_name}ï¼Œå·²ç»å®ç°äº†æ„¿æ™¯ã€‚  
    ... (åŸæœ‰ Prompt) ...  
      
    IMPORTANT \- æ ¹æ®è¿‡å¾€çš„äº¤äº’ç»éªŒï¼Œè¯·æ³¨æ„ä»¥ä¸‹ç­–ç•¥ï¼š  
    {strategy\_hint}  
    """  
      
    \# 3\. è°ƒç”¨ LLM ç”Ÿæˆå›å¤ (Act)  
    \# response \= ...  
      
    \# 4\. (å¯é€‰) å¼‚æ­¥è§¦å‘ä¸€æ¬¡è¿›åŒ–åˆ†æ  
    \# BackgroundTasks.add\_task(evolution\_service.evolve, request.message, response)  
      
    return response

### **ğŸ’¡ æ€»ç»“**

è¿™å¥—æ–¹æ¡ˆå®Œç¾åœ°ç»“åˆäº† **AgentEvolver** çš„ç†å¿µï¼Œå¹¶å°†å…¶è½å®åœ¨äº†æˆ‘ä»¬ç¨³å®šçš„ **SQLite \+ Chroma** æ¶æ„ä¸Šã€‚

1. **ç”¨æˆ·è§†è§’**ï¼šä½ æ„Ÿè§‰è¿™ä¸ª AI è®°æ€§ç‰¹åˆ«å¥½ï¼Œä¸ä»…è®°å¾—äº‹ï¼Œè¿˜è®°å¾—ä½ çš„â€œè„¾æ°”â€å’Œâ€œä¹ æƒ¯â€ã€‚  
2. **æŠ€æœ¯è§†è§’**ï¼š  
   * **Self-Questioning**: é€šè¿‡åå° LLM åˆ†ææ—¥å¿—å®ç°ã€‚  
   * **Self-Navigating**: é€šè¿‡ Chroma æ£€ç´¢ experiences å¹¶æ³¨å…¥ Prompt å®ç°ã€‚  
   * **Self-Attributing**: é€šè¿‡ LLM ç”Ÿæˆ insight å®ç°ã€‚

è¿™æ¯”å•çº¯çš„ä»£ç è‡ªåŠ¨è¿›åŒ–ï¼ˆAlphaEvolveï¼‰è¦å®‰å…¨å¾—å¤šï¼Œä¹Ÿæ›´æœ‰â€œäººå‘³å„¿â€ã€‚æ‚¨å¯ä»¥å¼€å§‹åœ¨ Trae ä¸­æ‰§è¡Œè¿™äº›å˜æ›´äº†ã€‚